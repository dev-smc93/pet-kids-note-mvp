# 프론트 & 백엔드 구조

## 1. 디렉터리 구조

```
app/
├── (main)/                 # 인증 필요 라우트 그룹
│   ├── layout.tsx          # AuthGuard 적용
│   ├── page.tsx            # 홈 (/)
│   ├── groups/             # 관리자: 원 관리
│   │   ├── page.tsx        # 원 목록
│   │   ├── new/page.tsx    # 원 생성
│   │   └── [id]/
│   │       └── page.tsx    # 원 상세 (승인 대기, 연결된 반려동물)
│   ├── join/page.tsx       # → /search-centers 리다이렉트
│   ├── search-centers/     # 보호자: 원 검색 및 연결 요청
│   │   └── page.tsx
│   └── my-pets/            # 보호자: 내 반려동물
│       ├── page.tsx
│       └── pets/
│           ├── new/page.tsx
│           └── [petId]/edit/page.tsx
├── auth/
│   ├── login, signup, profile/
├── api/
│   ├── auth/profile/       # GET, POST
│   ├── groups/             # GET (검색/목록), POST
│   ├── groups/[id]/        # GET, PATCH
│   ├── groups/[id]/requests/  # GET (승인 대기 목록)
│   ├── pets/               # GET, POST
│   ├── pets/[id]/          # PATCH, DELETE
│   ├── memberships/        # GET
│   ├── memberships/join/   # POST (연결 요청)
│   ├── memberships/[id]/   # PATCH (승인/거절), DELETE (거절된 요청 삭제)
│   └── upload/pet-photo/   # POST (반려동물 사진 업로드)
├── layout.tsx
└── globals.css

components/
├── auth/
├── groups/                 # group-list, group-form, group-detail
├── join/                   # my-pets-list
├── pets/                   # guardian-pet-form
├── providers/
└── ui/                     # button, input, select, confirm-dialog

lib/
├── api/auth.ts             # getAuthUser, requireAdmin
├── auth/
├── supabase/
└── prisma.ts
```

---

## 2. 라우팅 흐름

| 경로 | 접근 | 설명 |
|------|------|------|
| `/` | 인증 + 프로필 | 홈 (역할별 메뉴) |
| `/auth/*` | 비인증/인증 | 로그인, 회원가입, 프로필 |
| `/groups` | ADMIN | 원 목록 |
| `/groups/new` | ADMIN | 원 생성 |
| `/groups/[id]` | ADMIN | 원 상세 (승인 대기, 연결된 반려동물) |
| `/search-centers` | GUARDIAN | 원 검색 및 연결 요청 |
| `/my-pets` | GUARDIAN | 내 반려동물 |
| `/my-pets/pets/new` | GUARDIAN | 반려동물 등록 |
| `/my-pets/pets/[petId]/edit` | GUARDIAN | 반려동물 수정 |

---

## 3. API 구조

| 메서드 | 경로 | 설명 | 권한 |
|--------|------|------|------|
| GET | `/api/auth/profile` | 프로필 조회 | 인증 |
| POST | `/api/auth/profile` | 프로필 생성/수정 (관리자 시 원 정보 포함) | 인증 |
| GET | `/api/groups` | 내 원 목록 (ADMIN) 또는 시/도 검색 (?sido=) | 인증 |
| POST | `/api/groups` | 원 생성 | ADMIN |
| GET | `/api/groups/[id]` | 원 상세 (memberships) | ADMIN |
| PATCH | `/api/groups/[id]` | 원 정보 수정 | ADMIN |
| GET | `/api/groups/[id]/requests` | 승인 대기 목록 | ADMIN |
| GET | `/api/pets` | 내 반려동물 목록 | 인증 |
| POST | `/api/pets` | 반려동물 등록 | 인증 |
| PATCH | `/api/pets/[id]` | 반려동물 수정 | 소유자 |
| DELETE | `/api/pets/[id]` | 반려동물 삭제 | 소유자 |
| GET | `/api/memberships` | 내 연결 목록 | 인증 |
| POST | `/api/memberships/join` | 연결 요청 (groupId, petId) | 인증 |
| PATCH | `/api/memberships/[id]` | 승인/거절 (status: APPROVED\|REJECTED) | ADMIN |
| DELETE | `/api/memberships/[id]` | 거절된 요청 삭제 | 본인 |
| POST | `/api/upload/pet-photo` | 반려동물 사진 업로드 (FormData) | 인증 |

---

## 4. 인증 흐름

```
[회원가입] → Supabase Auth → /auth/profile
[로그인]   → Supabase Auth → / (홈)
[프로필]   → POST /api/auth/profile
[관리자]   → 프로필 시 원 정보(이름, 시/도, 시/군/구, 주소) 입력 → 원 자동 생성
```

---

## 5. 반려동물 연결 흐름

```
[관리자] 원 생성 (지역 정보 포함) → 승인 대기 요청 확인 → 승인/거절
[보호자] 반려동물 등록 → 원 검색 (시/도) → 연결 요청 → 관리자 승인 대기
```

---

## 6. 기술 스택

| 구분 | 기술 |
|------|------|
| Auth | Supabase Auth |
| DB | Supabase Postgres + Prisma |
| UI | React, Tailwind CSS, Radix UI (AlertDialog) |
| Framework | Next.js 16 (App Router) |
