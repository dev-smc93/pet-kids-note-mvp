# 프론트 & 백엔드 구조

## 1. 디렉터리 구조

```
app/
├── (main)/                 # 인증 필요 라우트 그룹
│   ├── layout.tsx          # AuthGuard 적용
│   ├── page.tsx            # 홈 (/)
│   ├── groups/             # 관리자: 원 관리
│   │   ├── page.tsx        # 원 목록
│   │   ├── new/page.tsx    # 원 생성
│   │   └── [id]/
│   │       └── page.tsx    # 원 상세 (승인 대기, 연결된 반려동물)
│   │       └── reports/
│   │           └── new/page.tsx  # 알림장 작성 (관리자)
│   ├── reports/            # 알림장
│   │   ├── page.tsx        # 알림장 목록 (필터: groupIds, mineOnly)
│   │   ├── filter/page.tsx # 필터 (원 다중 선택 체크박스, 내가 쓴 글만 보기 토글)
│   │   ├── new/page.tsx    # 알림장 작성 (원 선택 → 반려동물 선택 → 작성)
│   │   └── [id]/
│   │       ├── page.tsx    # 알림장 상세
│   │       └── edit/page.tsx  # 알림장 수정 (관리자)
│   ├── join/page.tsx       # → /search-centers 리다이렉트
│   ├── search-centers/     # 보호자: 원 검색 및 연결 요청
│   │   └── page.tsx
│   └── my-pets/            # 보호자: 내 반려동물
│       ├── page.tsx
│       └── pets/
│           ├── new/page.tsx
│           └── [petId]/edit/page.tsx
├── auth/
│   ├── login, signup, profile/
├── api/
│   ├── auth/profile/       # GET, POST
│   ├── groups/             # GET (검색/목록), POST
│   ├── groups/[id]/        # GET, PATCH
│   ├── groups/[id]/requests/  # GET (승인 대기 목록)
│   ├── pets/               # GET, POST
│   ├── pets/[id]/          # PATCH, DELETE
│   ├── memberships/        # GET
│   ├── memberships/join/   # POST (연결 요청)
│   ├── memberships/[id]/   # PATCH (승인/거절), DELETE (거절된 요청 삭제)
│   ├── reports/            # GET (목록), POST (작성)
│   ├── reports/[id]/       # GET, PATCH, DELETE
│   ├── reports/[id]/read/  # POST (읽음 처리)
│   ├── reports/[id]/remind/  # POST (재알림)
│   ├── reports/[id]/comments/  # GET (목록/예약?scheduled=true), POST (댓글)
│   │   └── [commentId]/       # PATCH (수정), DELETE (삭제)
│   ├── upload/pet-photo/   # POST (반려동물 사진 업로드)
│   └── upload/report-photo/  # POST (알림장 사진 업로드)
├── layout.tsx
└── globals.css

components/
├── auth/
├── groups/                 # group-list, group-form, group-detail
├── join/                   # my-pets-list
├── layout/                 # app-logo, main-header
├── pets/                   # guardian-pet-form
├── reports/                # report-form
├── providers/
└── ui/                     # button, input, select, confirm-dialog

lib/
├── api/auth.ts             # getAuthUser, requireAdmin
├── auth/
├── constants/              # images.ts (이미지 경로 상수)
├── supabase/               # client, server, middleware
└── prisma.ts

supabase/
└── enable_realtime_report_comments.sql  # report_comments Realtime 활성화

public/
└── images/
    └── logo/               # app-logo.svg, icon.svg (favicon)
```

---

## 2. 라우팅 흐름

| 경로                         | 접근          | 설명                                 |
| ---------------------------- | ------------- | ------------------------------------ |
| `/`                          | 인증 + 프로필 | 홈 (역할별 메뉴)                     |
| `/auth/*`                    | 비인증/인증   | 로그인, 회원가입, 프로필             |
| `/groups`                    | ADMIN         | 원 목록                              |
| `/groups/new`                | ADMIN         | 원 생성                              |
| `/groups/[id]`               | ADMIN         | 원 상세 (승인 대기, 연결된 반려동물) |
| `/groups/[id]/reports/new`   | ADMIN         | 알림장 작성                         |
| `/reports`                   | 인증          | 알림장 목록 (?groupIds=, ?mineOnly=) |
| `/reports/filter`            | 인증          | 필터 (원 다중 선택, 내가 쓴 글만 보기) |
| `/reports/new`               | ADMIN         | 알림장 작성 (원 선택 → 반려동물 선택 → 작성) |
| `/reports/[id]`              | 인증          | 알림장 상세 (읽음, 댓글)            |
| `/reports/[id]/edit`         | ADMIN         | 알림장 수정                         |
| `/search-centers`            | GUARDIAN      | 원 검색 및 연결 요청                 |
| `/my-pets`                   | GUARDIAN      | 내 반려동물                          |
| `/my-pets/pets/new`          | GUARDIAN      | 반려동물 등록                        |
| `/my-pets/pets/[petId]/edit` | GUARDIAN      | 반려동물 수정                        |

---

## 3. API 구조

| 메서드 | 경로                        | 설명                                        | 권한   |
| ------ | --------------------------- | ------------------------------------------- | ------ |
| GET    | `/api/auth/profile`         | 프로필 조회                                 | 인증   |
| POST   | `/api/auth/profile`         | 프로필 생성/수정 (관리자 시 원 정보 포함)   | 인증   |
| GET    | `/api/groups`               | 내 원 목록 (ADMIN) 또는 시/도 검색 (?sido=) | 인증   |
| POST   | `/api/groups`               | 원 생성                                     | ADMIN  |
| GET    | `/api/groups/[id]`          | 원 상세 (memberships)                       | ADMIN  |
| PATCH  | `/api/groups/[id]`          | 원 정보 수정                                | ADMIN  |
| GET    | `/api/groups/[id]/requests` | 승인 대기 목록                              | ADMIN  |
| GET    | `/api/pets`                 | 내 반려동물 목록                            | 인증   |
| POST   | `/api/pets`                 | 반려동물 등록                               | 인증   |
| PATCH  | `/api/pets/[id]`            | 반려동물 수정                               | 소유자 |
| DELETE | `/api/pets/[id]`            | 반려동물 삭제                               | 소유자 |
| GET    | `/api/memberships`          | 내 연결 목록                                | 인증   |
| POST   | `/api/memberships/join`     | 연결 요청 (groupId, petId)                  | 인증   |
| PATCH  | `/api/memberships/[id]`     | 승인/거절 (status: APPROVED\|REJECTED)      | ADMIN  |
| DELETE | `/api/memberships/[id]`     | 거절된 요청 삭제                            | 본인   |
| GET    | `/api/reports`              | 알림장 목록 (?groupIds= 다중 원 필터, ?mineOnly= 내가 쓴 글만) | 인증   |
| POST   | `/api/reports`              | 알림장 작성                                 | ADMIN  |
| GET    | `/api/reports/[id]`         | 알림장 상세                                 | 인증   |
| PATCH  | `/api/reports/[id]`         | 알림장 수정                                 | ADMIN  |
| DELETE | `/api/reports/[id]`         | 알림장 삭제                                 | ADMIN  |
| POST   | `/api/reports/[id]/read`    | 읽음 처리                                   | GUARDIAN |
| POST   | `/api/reports/[id]/remind`  | 재알림 (표시만)                             | ADMIN  |
| GET    | `/api/reports/[id]/comments`| 댓글 목록 (일반+예약완료) 또는 예약 댓글 (?scheduled=true) | 인증   |
| POST   | `/api/reports/[id]/comments`| 댓글 작성 (body: content, scheduledAt?)                   | 인증   |
| PATCH  | `/api/reports/[id]/comments/[commentId]` | 댓글 수정 | 본인   |
| DELETE | `/api/reports/[id]/comments/[commentId]` | 댓글 삭제 | 본인   |
| POST   | `/api/upload/pet-photo`     | 반려동물 사진 업로드 (FormData)             | 인증   |
| POST   | `/api/upload/report-photo`   | 알림장 사진 업로드 (FormData)               | ADMIN  |

---

## 4. 인증 흐름

```
[회원가입] → Supabase Auth → /auth/profile
[로그인]   → Supabase Auth → / (홈)
[프로필]   → POST /api/auth/profile
[관리자]   → 프로필 시 원 정보(이름, 시/도, 시/군/구, 주소) 입력 → 원 자동 생성
```

---

## 5. 반려동물 연결 흐름

```
[관리자] 원 생성 (지역 정보 포함) → 승인 대기 요청 확인 → 승인/거절
[보호자] 반려동물 등록 → 원 검색 (시/도) → 연결 요청 → 관리자 승인 대기
```

---

## 6. 공통 레이아웃

| 컴포넌트     | 용도                                                                                               |
| ------------ | -------------------------------------------------------------------------------------------------- |
| `MainHeader` | (main) 라우트 공통 헤더. `variant="home"` (로고+프로필/로그아웃), `variant="back"` (로고+뒤로가기) |
| `AppLogo`    | 앱 로고 (발바닥 아이콘 + "반려동물 알림장"). `showText`, `asLink`, `size` 옵션                     |

이미지 경로는 `lib/constants/images.ts`에서 관리.

---

## 7. Supabase Realtime

| 항목 | 설명 |
|------|------|
| 구독 대상 | `report_comments` 테이블 (INSERT/UPDATE/DELETE) |
| 적용 화면 | `/reports/[id]` 알림장 상세 |
| 동작 | 댓글 변경 시 새로고침 없이 즉시 반영 |
| 예약 댓글 | DB 변경 없음 → 가장 가까운 예약 시각에 타이머로 refetch |
| 설정 | `supabase_realtime` publication에 `report_comments` 추가 필요 |

## 8. 알림장 상세 댓글 UI

| 항목 | 설명 |
|------|------|
| 레이아웃 | 알림창:댓글창 비율 3:2 (flex-[3], flex-[2]) |
| 댓글 목록 | overflow-y-auto, 새 댓글 시 맨 아래 자동 스크롤 |
| 내 댓글 클릭 | 댓글 복사, 댓글 수정, 댓글 삭제 |
| 상대방 댓글 클릭 | 댓글 복사만 (수정/삭제 숨김) |
| 댓글 복사 | 클립보드 복사 + 댓글 입력창에 붙여넣기 |
| 예약 댓글 | 시계 버튼 → 예약 모달, 점선 테두리 + "예약" 배지, 예약 취소 버튼 |
| 예약 완료 시간 | scheduledAt 기준 표시 |

## 9. 기술 스택

| 구분      | 기술                                        |
| --------- | ------------------------------------------- |
| Auth      | Supabase Auth                               |
| DB        | Supabase Postgres + Prisma                  |
| Realtime  | Supabase Realtime (report_comments)         |
| UI        | React, Tailwind CSS, Radix UI (AlertDialog) |
| Framework | Next.js 16 (App Router)                     |
